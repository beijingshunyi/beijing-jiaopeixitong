<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教培系统后台管理面板</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar h2 {
            margin-bottom: 30px;
            text-align: center;
            color: #ecf0f1;
        }
        
        .sidebar ul {
            list-style: none;
        }
        
        .sidebar ul li {
            margin-bottom: 5px;
        }
        
        .sidebar ul li a {
            color: white;
            text-decoration: none;
            display: block;
            padding: 12px 15px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .sidebar ul li a:hover {
            background-color: #34495e;
            transform: translateX(5px);
        }
        
        .sidebar ul li a.active {
            background-color: #3498db;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            margin-left: 250px;
        }
        
        .header {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 24px;
        }
        
        .header .user-info {
            display: flex;
            align-items: center;
        }
        
        .header .user-info span {
            margin-right: 15px;
            color: #7f8c8d;
        }
        
        .header .user-info button {
            padding: 8px 16px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .dashboard {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: #ecf0f1;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-card h3 {
            color: #7f8c8d;
            margin-bottom: 15px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-card p {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-card.primary {
            background-color: #3498db;
            color: white;
        }
        
        .stat-card.primary h3 {
            color: rgba(255,255,255,0.8);
        }
        
        .stat-card.primary p {
            color: white;
        }
        
        .stat-card.success {
            background-color: #2ecc71;
            color: white;
        }
        
        .stat-card.success h3 {
            color: rgba(255,255,255,0.8);
        }
        
        .stat-card.success p {
            color: white;
        }
        
        .stat-card.warning {
            background-color: #f39c12;
            color: white;
        }
        
        .stat-card.warning h3 {
            color: rgba(255,255,255,0.8);
        }
        
        .stat-card.warning p {
            color: white;
        }
        
        .section {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .api-test {
            margin-top: 20px;
        }
        
        .api-test h2 {
            margin-bottom: 20px;
        }
        
        .test-form {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .test-form h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .test-form input,
        .test-form select,
        .test-form textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .test-form textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .test-form .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .test-form button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        
        .test-form button:hover {
            background-color: #2980b9;
        }
        
        .test-form button.secondary {
            background-color: #95a5a6;
        }
        
        .test-form button.secondary:hover {
            background-color: #7f8c8d;
        }
        
        .response {
            background-color: #e8f4f8;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            margin-top: 20px;
        }
        
        .response h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .response pre {
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .response .status-code {
            display: inline-block;
            padding: 3px 8px;
            background-color: #3498db;
            color: white;
            border-radius: 3px;
            font-size: 12px;
            margin-bottom: 10px;
        }
        
        .tab-container {
            margin-bottom: 20px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab:hover {
            color: #3498db;
        }
        
        .tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }
        
        tr:hover {
            background-color: #f5f5f5;
        }
        
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background-color 0.3s ease;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2>教培系统管理</h2>
            <ul>
                <li><a href="#" class="active" data-tab="dashboard">首页</a></li>
                <li><a href="#" data-tab="user-management">用户管理</a></li>
                <li><a href="#" data-tab="course-management">课程管理</a></li>
                <li><a href="#" data-tab="attendance-management">考勤管理</a></li>
                <li><a href="#" data-tab="finance-management">财务管理</a></li>
                <li><a href="#" data-tab="reports">统计报表</a></li>
                <li><a href="#" data-tab="system-settings">系统设置</a></li>
                <li><a href="#" data-tab="api-test">API测试工具</a></li>
            </ul>
        </div>
        
        <div class="main-content">
            <div class="header">
                <h1>后台管理面板</h1>
                <div class="user-info">
                    <span>管理员</span>
                    <button onclick="logout()">退出登录</button>
                </div>
            </div>
            
            <!-- 首页仪表盘 -->
            <div class="tab-content active" id="dashboard">
                <div class="dashboard">
                    <h2>系统概览</h2>
                    <div class="stats-grid">
                        <div class="stat-card primary">
                            <h3>总用户数</h3>
                            <p id="userCount">128</p>
                        </div>
                        <div class="stat-card success">
                            <h3>总课程数</h3>
                            <p id="courseCount">45</p>
                        </div>
                        <div class="stat-card warning">
                            <h3>今日考勤</h3>
                            <p id="attendanceCount">89</p>
                        </div>
                        <div class="stat-card">
                            <h3>总收入</h3>
                            <p id="revenueCount">¥12,580</p>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>最近活动</h2>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>时间</th>
                                    <th>用户</th>
                                    <th>操作</th>
                                    <th>状态</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>2024-01-28 14:30</td>
                                    <td>张三</td>
                                    <td>登录系统</td>
                                    <td>成功</td>
                                </tr>
                                <tr>
                                    <td>2024-01-28 14:25</td>
                                    <td>李四</td>
                                    <td>打卡</td>
                                    <td>成功</td>
                                </tr>
                                <tr>
                                    <td>2024-01-28 14:20</td>
                                    <td>王五</td>
                                    <td>报名课程</td>
                                    <td>成功</td>
                                </tr>
                                <tr>
                                    <td>2024-01-28 14:15</td>
                                    <td>赵六</td>
                                    <td>修改密码</td>
                                    <td>成功</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- 用户管理 -->
            <div class="tab-content" id="user-management">
                <div class="section">
                    <h2>用户管理</h2>
                    <div class="test-form">
                        <h3>创建用户</h3>
                        <div class="form-row">
                            <input type="text" id="createUserName" placeholder="姓名">
                            <input type="email" id="createUserEmail" placeholder="邮箱">
                        </div>
                        <div class="form-row">
                            <input type="password" id="createUserPassword" placeholder="密码">
                            <select id="createUserRole">
                                <option value="1">管理员</option>
                                <option value="2">教务人员</option>
                                <option value="3">教师</option>
                                <option value="4">学生</option>
                            </select>
                        </div>
                        <button onclick="createUser()">创建用户</button>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>姓名</th>
                                    <th>邮箱</th>
                                    <th>角色</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody">
                                <!-- 动态生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- 课程管理 -->
            <div class="tab-content" id="course-management">
                <div class="section">
                    <h2>课程管理</h2>
                    <div class="test-form">
                        <h3>创建课程</h3>
                        <div class="form-row">
                            <input type="text" id="createCourseName" placeholder="课程名称">
                            <input type="text" id="createCourseCode" placeholder="课程代码">
                        </div>
                        <div class="form-row">
                            <input type="number" id="createCourseCredit" placeholder="学分">
                            <input type="number" id="createCourseHours" placeholder="课时">
                        </div>
                        <button onclick="createCourse()">创建课程</button>
                    </div>
                </div>
            </div>
            
            <!-- 考勤管理 -->
            <div class="tab-content" id="attendance-management">
                <div class="section">
                    <h2>考勤管理</h2>
                    <div class="test-form">
                        <h3>打卡测试</h3>
                        <div class="form-row">
                            <input type="text" id="checkInCourseId" placeholder="课程ID">
                            <input type="text" id="checkInLocation" placeholder="位置">
                        </div>
                        <button onclick="testCheckIn()">测试打卡</button>
                    </div>
                </div>
            </div>
            
            <!-- 财务管理 -->
            <div class="tab-content" id="finance-management">
                <div class="section">
                    <h2>财务管理</h2>
                    <div class="stats-grid">
                        <div class="stat-card primary">
                            <h3>本月收入</h3>
                            <p>¥5,280</p>
                        </div>
                        <div class="stat-card success">
                            <h3>本月支出</h3>
                            <p>¥1,850</p>
                        </div>
                        <div class="stat-card warning">
                            <h3>本月利润</h3>
                            <p>¥3,430</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 统计报表 -->
            <div class="tab-content" id="reports">
                <div class="section">
                    <h2>统计报表</h2>
                    <p>统计报表功能开发中...</p>
                </div>
            </div>
            
            <!-- 系统设置 -->
            <div class="tab-content" id="system-settings">
                <div class="section">
                    <h2>系统设置</h2>
                    <p>系统设置功能开发中...</p>
                </div>
            </div>
            
            <!-- API测试工具 -->
            <div class="tab-content" id="api-test">
                <div class="section">
                    <h2>API测试工具</h2>
                    <div class="test-form">
                        <h3>用户登录测试</h3>
                        <input type="email" id="loginEmail" placeholder="邮箱" value="test@example.com">
                        <input type="password" id="loginPassword" placeholder="密码" value="password123">
                        <button onclick="testLogin()">测试登录</button>
                    </div>
                    
                    <div class="test-form">
                        <h3>用户注册测试</h3>
                        <input type="text" id="registerName" placeholder="姓名" value="测试用户">
                        <input type="email" id="registerEmail" placeholder="邮箱" value="test@example.com">
                        <input type="password" id="registerPassword" placeholder="密码" value="password123">
                        <button onclick="testRegister()">测试注册</button>
                    </div>
                    
                    <div class="test-form">
                        <h3>学生打卡测试</h3>
                        <input type="text" id="checkInTestCourseId" placeholder="课程ID" value="1">
                        <input type="text" id="checkInTestLocation" placeholder="位置" value="北京市朝阳区">
                        <button onclick="testStudentCheckIn()">测试打卡</button>
                    </div>
                    
                    <div class="test-form">
                        <h3>获取学生课程</h3>
                        <button onclick="getStudentCourses()">获取课程</button>
                    </div>
                    
                    <div class="response">
                        <h3>API响应</h3>
                        <pre id="apiResponse">点击上方按钮测试API</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 模拟数据
        document.getElementById('userCount').textContent = '128';
        document.getElementById('courseCount').textContent = '45';
        document.getElementById('attendanceCount').textContent = '89';
        document.getElementById('revenueCount').textContent = '¥12,580';
        
        // 标签页切换
        document.querySelectorAll('.sidebar a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // 移除所有活动状态
                document.querySelectorAll('.sidebar a').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelectorAll('.tab-content').forEach(item => {
                    item.classList.remove('active');
                });
                
                // 添加当前活动状态
                this.classList.add('active');
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // 测试登录API
        async function testLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                const responseElement = document.getElementById('apiResponse');
                responseElement.innerHTML = `<div class="status-code">${response.status}</div>${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                document.getElementById('apiResponse').textContent = '错误: ' + error.message;
            }
        }
        
        // 测试注册API
        async function testRegister() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        name, 
                        email, 
                        password, 
                        role_id: 4 
                    })
                });
                
                const data = await response.json();
                const responseElement = document.getElementById('apiResponse');
                responseElement.innerHTML = `<div class="status-code">${response.status}</div>${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                document.getElementById('apiResponse').textContent = '错误: ' + error.message;
            }
        }
        
        // 测试学生打卡
        async function testStudentCheckIn() {
            const courseId = document.getElementById('checkInTestCourseId').value;
            const location = document.getElementById('checkInTestLocation').value;
            
            try {
                // 先登录获取token
                const loginResponse = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        email: 'test123@example.com', 
                        password: 'password123' 
                    })
                });
                
                const loginData = await loginResponse.json();
                const token = loginData.token;
                
                // 使用token进行打卡
                const checkInResponse = await fetch('/api/student/checkin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ 
                        courseId, 
                        location, 
                        deviceInfo: 'Test Device' 
                    })
                });
                
                const checkInData = await checkInResponse.json();
                const responseElement = document.getElementById('apiResponse');
                responseElement.innerHTML = `<div class="status-code">${checkInResponse.status}</div>${JSON.stringify(checkInData, null, 2)}`;
            } catch (error) {
                document.getElementById('apiResponse').textContent = '错误: ' + error.message;
            }
        }
        
        // 获取学生课程
        async function getStudentCourses() {
            try {
                // 先登录获取token
                const loginResponse = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        email: 'test123@example.com', 
                        password: 'password123' 
                    })
                });
                
                const loginData = await loginResponse.json();
                const token = loginData.token;
                
                // 使用token获取课程
                const coursesResponse = await fetch('/api/student/courses/available', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const coursesData = await coursesResponse.json();
                const responseElement = document.getElementById('apiResponse');
                responseElement.innerHTML = `<div class="status-code">${coursesResponse.status}</div>${JSON.stringify(coursesData, null, 2)}`;
            } catch (error) {
                document.getElementById('apiResponse').textContent = '错误: ' + error.message;
            }
        }
        
        // 创建用户
        async function createUser() {
            const name = document.getElementById('createUserName').value;
            const email = document.getElementById('createUserEmail').value;
            const password = document.getElementById('createUserPassword').value;
            const roleId = document.getElementById('createUserRole').value;
            
            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        name, 
                        email, 
                        password, 
                        role_id: parseInt(roleId) 
                    })
                });
                
                const data = await response.json();
                alert('用户创建' + (response.ok ? '成功' : '失败: ' + data.error));
                
                if (response.ok) {
                    // 刷新用户列表
                    loadUsers();
                }
            } catch (error) {
                alert('错误: ' + error.message);
            }
        }
        
        // 创建课程
        async function createCourse() {
            const name = document.getElementById('createCourseName').value;
            const code = document.getElementById('createCourseCode').value;
            const credit = document.getElementById('createCourseCredit').value;
            const hours = document.getElementById('createCourseHours').value;
            
            try {
                // 这里需要管理员权限的API
                alert('课程创建功能开发中');
            } catch (error) {
                alert('错误: ' + error.message);
            }
        }
        
        // 加载用户列表
        async function loadUsers() {
            try {
                // 这里需要管理员权限的API
                const users = [
                    { id: '1', name: '管理员', email: 'admin@example.com', role: '管理员' },
                    { id: '2', name: '教师', email: 'teacher@example.com', role: '教师' },
                    { id: '3', name: '学生', email: 'student@example.com', role: '学生' }
                ];
                
                const tableBody = document.getElementById('userTableBody');
                tableBody.innerHTML = '';
                
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.role}</td>
                        <td>
                            <button class="btn btn-primary" onclick="editUser('${user.id}')">编辑</button>
                            <button class="btn btn-danger" onclick="deleteUser('${user.id}')">删除</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('加载用户失败:', error);
            }
        }
        
        // 编辑用户
        function editUser(userId) {
            alert('编辑用户: ' + userId);
        }
        
        // 删除用户
        function deleteUser(userId) {
            if (confirm('确定要删除用户吗？')) {
                alert('删除用户: ' + userId);
            }
        }
        
        // 测试打卡
        async function testCheckIn() {
            const courseId = document.getElementById('checkInCourseId').value;
            const location = document.getElementById('checkInLocation').value;
            
            try {
                // 这里需要学生权限的API
                alert('打卡测试功能开发中');
            } catch (error) {
                alert('错误: ' + error.message);
            }
        }
        
        // 退出登录
        function logout() {
            alert('退出登录');
        }
        
        // 初始加载用户列表
        loadUsers();
    </script>
</body>
</html>